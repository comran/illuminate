cmake_minimum_required(VERSION 3.2)

project(BuildProtobuf NONE)

set(Protobuf_VERSION "3.9.1")
set(Protobuf_SHA1 "f2552500fbafaf9a9af534693aa7450c51d7a196")

include(ExternalProject)
ExternalProject_Add(Protobuf
    PREFIX            "${CMAKE_CURRENT_BINARY_DIR}"
    URL "https://github.com/protocolbuffers/protobuf/releases/download/v${Protobuf_VERSION}/protobuf-cpp-${Protobuf_VERSION}.tar.gz"
    URL_HASH          SHA1=${Protobuf_SHA1}
    STAMP_DIR         "${CMAKE_CURRENT_BINARY_DIR}/stamp"
    DOWNLOAD_DIR      "${CMAKE_CURRENT_BINARY_DIR}"
    SOURCE_DIR        "${CMAKE_CURRENT_BINARY_DIR}/src"
    BINARY_DIR        "${CMAKE_CURRENT_BINARY_DIR}/build"
    INSTALL_DIR       "${CMAKE_CURRENT_BINARY_DIR}/install"
    SOURCE_SUBDIR     "cmake"
    CMAKE_GENERATOR   "@CMAKE_GENERATOR@"
    CMAKE_ARGS        -DCMAKE_BUILD_TYPE=@CMAKE_BUILD_TYPE@
                      -DCMAKE_TOOLCHAIN_FILE=@CMAKE_TOOLCHAIN_FILE@
                      -DCMAKE_INSTALL_PREFIX=${CMAKE_CURRENT_BINARY_DIR}/install
                      -Dprotobuf_BUILD_TESTS=OFF
                      -Dprotobuf_BUILD_CONFORMANCE=OFF
                      -Dprotobuf_BUILD_EXAMPLES=OFF
                      -Dprotobuf_BUILD_PROTOC_BINARIES=ON
    TEST_COMMAND      ""
)